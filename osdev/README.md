# OCap OS Dev Exploration with VirtualBox

This directory contains tools to create a VirtualBox VM that boots from a physical disk, for operating system development experiments.

## Setup

1.  **Check Configuration**: The `Makefile` has defaults for `TARGET_DISK` and `VM_NAME`. To see them, run `make -C osdev`. To override, set environment variables:
    ```sh
    export TARGET_DISK=/dev/disk/by-id/ata-YOUR_DISK_NAME_HERE  # WARNING: Use a stable name from 'ls /dev/disk/by-id'
    ```
    **WARNING**: Subsequent steps can wipe this disk.

2.  **Set Permissions**: Grant your user access to raw disks.
    ```sh
    make perms
    ```
    Then, **log out and log back in** for the group change to take effect.

3.  **Create VMDK**: Generate the `.vmdk` file that points to the physical disk.
    ```sh
    make physical.vmdk
    ```

4.  **Create VirtualBox VM**:
    -   Open VirtualBox.
    -   Create a new VM (the name must match `VM_NAME` from the `Makefile`).
    -   When asked for a Hard Disk, select "Use an existing virtual hard disk file" and choose `osdev/physical.vmdk`.
    -   Ensure EFI is enabled in the VM settings if you're booting an EFI system.

5.  **Provision Disk (Optional & DESTRUCTIVE)**: If the disk is empty, you can partition and format it. First, you can check if it's already partitioned correctly:
    ```sh
    sudo make -C osdev check-partitioning
    ```
    If not, you can use the destructive targets. The partition layout is defined in `partition-table.sfdisk`. **THIS WILL WIPE THE DISK.**
    ```sh
    # Example for partitioning and formatting
    sudo make partition-disk
    sudo make format-disk
    ```

6.  **Run**:
    ```sh
    make run
    ```

## Files

-   `README.md`: This file.
-   `Makefile`: Automation for setup and management.
-   `partition-table.sfdisk`: Declarative partition layout for the target disk.
-   `physical.vmdk`: A placeholder file. The real file is generated by `make physical.vmdk` and points VirtualBox to a raw physical disk.
